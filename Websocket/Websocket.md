#  Обработка бинарных данных

Тип сигнатуры перегрузки `WebSocket.on` с event: "message":

```ts
on(event: "message", listener: (this: WebSocket, data: WebSocket.RawData, isBinary: boolean) => void): this;
```

![[Pasted image 20250109222234.png]]

# Безопасность

## Ограничение числа подключений

> [!note|badge]
> Во втором параметре коллбэка передаваемого в `wss.on("connection", cb)` - `IncomingMessage` (из встроенного в Node.js модуля `http`), можно обратится к  `.socket.remoteAddress`, чтобы узнать ip адрес.

# Как отправлять сообщения сразу всем клиентам

> [!tip|badge]
> Обработчик ставится именно на wss:

```ts
wss.on('message', (message) => {
  wss.clients.forEach((client) => {
    if (client.readyState === WebSocket.OPEN) {
      client.send(message);
    }
  });
});
```

> [!tip|badge]
> В `wss.clients` хранятся подключенные клиенты.

# Задания

1. Когда клиент отправляет сообщение, у клиента оно должно быть помечено часами, если сервер пришлет сообщение, что он получил это сообщение, то оно считается готовым (помечается галочкой). Если же соединение было разорвано, то сообщение должно быть помечено ошибкой и при восстановлении соединения, можно будет отправить его еще раз.
2. Реализовать автоматический повторный запрос
4. Ивентовую систему сделать
